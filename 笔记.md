# 杂碎的笔记

## 从字典里随机选择一个值

```python
import random

dict_ = {"key2": "value1",
       "key2": "value2"}

randkey = random.choice(dict_.key()) # python2.x
randkey = random.choice(list(dict_.keys()))  # python3.x
```

`random.choice(seq)` 只接受序列（列表，字符串、、、），直接使用字典就不可以。可以将字典里全部的`键`或`值`转换为一个列表`dict_.keys()`或者`dict_.values()`，在Python3.x中返回的是可迭代器（iterator），所以要使用`list(dict_.keys())`.

这样就可以将字典里的值或键随机取出。

## Cookies

requests 请求http是怎么加入多个cookie呢？

`cookie: cookie1=baba;cookie2=babab`

#### HttpOnly

这个是用来减少`xss`攻击的。设置之后不能再脚本里获取这个cookie

#### no-cache = "set-cookie"

不太清楚


## 字典的困惑 {"key": "value"} + {"value": "key"}

字典要是相加不改变原来的就好了： 相加没有副作用

利用函数闭包就好了

```python
def dict_(value):
    _dict = {"already": "1"}
    return _dict.update({"key": value})
```

## 获取函数的参数

```python
def fun_1(**_dict):
    print type(_dict)
    print _dict
    return None

def fun_2(*_tuple):
    print type(_tuple)
    print _tuple
    return None

In [2]: fun(ni="ni")
<type 'dict'>
{'ni': 'ni'}

In [5]: fun2("ni")
<type 'tuple'>
('ni',)
```

`*identifier`： 位置参数全部收集到一个元组`("tuple",)`默认为空

`**identifier`： 关键字参数收集成为一个字典`{}`默认为空

#### 解包是什么鬼？ unpack

```python
pack = ("1", "2", "3")
# unpack
one, two, three = pack

In [9]: one
Out[9]: '1'

```
解包是将序列映射到变量上的方法

## 命令行参数

```python
from sys import argv

a, b, c = argv
```

##　关闭`requests`的重定向功能 https 检查 及其警告

```python
import requests

requests.packages.urllib3.disable_warnings()

url = "http://www.pengwk.com"
requests.get(url, allow_redirects=False, verify=False)
```

#### cookies 变成字典 

```python
import requests

res = requests.get(url)
res.cookies.get_dict()

In [14]: res.cookies.get_dict()
Out[14]: {'PHPSESSID': '2c53m9h6ij3h1fi9rmrmid26g0'}
```


## Command–query separation

<https://en.wikipedia.org/wiki/Command%E2%80%93query_separation>


Python's mostly implementing a pragmatically tinged flavor of command-query separation: mutators return None (with pragmatically induced exceptions such as pop;-) so they can't possibly be confused with accessors (and in the same vein, assignment is not an expression, the statement-expression separation is there, and so forth).


## BeautifulSoup 提取数据

###### 关键字

`find_all` `find` `class`  `css` `html` `tag` `string` `get_text` `attr` `name`

`input` `form` `value` `Tag` `NavigableString` `BeautifulSoup` `Comment`

#### html本身组成

```html
<!DOCTYPE html>
<html>
<head>
    <title></title>
</head>
<body>

</body>
</html>
```
###### Tag 节点

```html
<a href="pengwk.com/">pengwk.com</a>  <!-- 一个节点-->
```
```python
from bs4 import BeautifulSoup

soup = BeautifulSoup("<a href="pengwk.com" class="red" id="blog">pengwk's personal website</a>")

tag = soup.a
type(tag)

In [54]: type(soup.a)
Out[54]: bs4.element.Tag

```
&emsp;&emsp;`BeautifulSoup` 里的`Tag`对象（object）它代表了 `HTML` 或者 `XML` 文档里的`Tag`。

节点是有名字的`<a href=""></a>`中的`a`

也是有属性的 可以搜索 

层级关系 父母 孩子 同辈 

使用函数搜索 可以将多种参数作为搜索条件 函数判断 属性判断  正则表达式 搜索内容`string`

css 选择器 CSS是HTML中用来标记节点类别服务于调整外观

使用CSS class 类搜索
```python
from bs4 import BeautifulSoup

css_soup = BeautifulSoup("<p class="Bold Nice">This is a paragraph</p>")

css_soup.find_all("p", class_="Bold")

css_soup.find_all("p", class_="Nice")

css_soup.find_all("p", class_="Bold Nice") # 顺序不能反 eg:Nice Bold

# 获取节点所有属性
In [18]: hidden[0].attrs
Out[18]:
{'name': '__RequestVerificationToken',
 'type': 'hidden',
 'value': 'R_RIxPF6NGOxOJ2PLWU81tOY46cc-L-kPPaaWEZ-EhU189AV2A05J7FGfl19T-zU5zi2DD0k9FiOKIGc-mExfRA2DZk_gytZMhMmmODwXGF9h5K_YmZFPdvBWK9mb60UAvTFqe-L1kvMlefvrykQmpDq6ey9K-cqNcD61F8QulE1'}

 # 像字典一样获取属性
In [19]: hidden[0]["name"]
Out[19]: '__RequestVerificationToken'

# 同一个属性有多个值时 返回列表

css_soup.p["class"]
["bold", "Nice"]
```

###### 关键字参数搜索

&emsp;&emsp;关键字参数搜索用于在节点中找到`<p id="new" data-switch="ok"></p>`
`id`为具体值的节点 如果包含连接线的，或者其他Python不能允许的字符时，可以将键值对变成字典(attrs={})传入。

```python
from bs4 import BeautifulSoup

soup = BeautifulSoup("<p id="new" data-switch="ok"></p>")
soup.find_all(id="new")

soup.find_all(attrs={"data-switch": True})
```

string 对象转换为Unicode对象 `unicode(soup.b.string)`

###### 位置参数搜索

默认的位置参数搜索是`name`

```python
from bs4 import BeautifulSoup

soup = BeautifulSoup("<title></title>")
soup.find_all("title")
```

###### 其他

列表：搜索任意在列表里的项目
函数：符合条件返回`True`
正则表达式

###### 字符集处理

Unicode Dammit

Microsoft Smart quotes

Inconsistent encoding Windows1252

UnicodeDammit.detwingle()

#### requests

`requests.Response.text` `requests.Response.content` 区别

第一个返回的是`Unicode`字符串，编码方式是由`chardet`或者`Response.encoding`决定 

第二个返回的是`in bytes`

#### 加速

`pip install cchardet` 字符集检测

使用`lxml`作为默认的解析器

## 自动重试在请求时

次数统计 自动统计 可以停止 

```python
while count > 0:
    try:
        do something

        count -= 1

```

## 使用日志记录关键信息 调试

```python
from auth import JWCAuth
jwc = JWCAuth("201441302623", "pwkilove5")
v = jwc.login()
print v

'/error/appid.html?token=jwxt -c-e9a1b5c6a9c5edfda414d95f650e2a7f0440dc4b4826&platform=pc
```